{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "GeoView Core Config Schema",
  "type": "object",
  "version": 1.0,
  "comments": "Configuration for GeoView core packages, each packages manages it own schema.",
  "additionalProperties": false,

  "definitions": {
    "detailsLayerSettings": {
      "type": "object",
      "properties": {
        "parser": {
          "type": "string",
          "description": "A path to a javascript file with a function for parsing the layers identify output. Only needed if a custom template is being used."
        },
        "template": {
          "type": "object",
          "properties": {
            "en": {
              "type": "string",
              "description": "A path to an html template (English) that will override default identify output."
            },
            "fr": {
              "type": "string",
              "description": "A path to an html template (French) that will override default identify output."
            }
          }
        }
      },
      "required": ["template"],
      "additionalProperties": false
    },

    "featureInfoLayerSettings": {
      "customParser": { "$ref": "#/definitions/detailsLayerSettings" },
      "nameField": {
        "type": "object",
        "properties": {
          "en": {
            "type": "string",
            "description": "The display field (English) of the layer. If it is not present the viewer will make an attempt to find the first valid field."
          },
          "fr": {
            "type": "string",
            "description": "The display field (French) of the layer. If it is not present the viewer will make an attempt to find the first valid field."
          }
        }
      },
      "tooltipField": {
        "type": "object",
        "properties": {
          "en": {
            "type": "string",
            "description": "The field (English) to be used for tooltips. If it is not present the viewer will use nameField (if provided)."
          },
          "fr": {
            "type": "string",
            "description": "The field (French) to be used for tooltips. If it is not present the viewer will use nameField (if provided)."
          }
        }
      },
      "outfields": {
        "type": "object",
        "properties": {
          "en": {
            "type": "string",
            "default": "*",
            "description": "A comma separated list of attribute names (English) that should be requested on query (all by default)."
          },
          "fr": {
            "type": "string",
            "default": "*",
            "description": "A comma separated list of attribute names (French) that should be requested on query (all by default)."
          }
        }
      },
      "aliasFields": {
        "type": "object",
        "properties": {
          "en": {
            "type": "string",
            "default": "",
            "description": "A comma separated list of attribute names (English) that should be use for alias. If empty, no alias will be set if not found."
          },
          "fr": {
            "type": "string",
            "default": "",
            "description": "A comma separated list of attribute names (French) that should be use for alias. If empty, no alias will be set if not found."
          }
        }
      }
    },

    "fillSymbolNode": {
      "type": "object",
      "description": "Fill style for vector features.",
      "properties": {
        "color": {
          "type": "string"
        }
      },
      "required": ["color"]
    },
    "strokeSymbolNode": {
      "type": "object",
      "description": "Stroke style for vector features.",
      "properties": {
        "color": {
          "type": "string"
        },
        "width": {
          "type": "number"
        }
      },
      "required": ["color", "width"]
    },
    "simpleSymbolVectorSettings": {
      "type": "object",
      "properties": {
        "fill": { "$ref": "#/definitions/fillSymbolNode" },
        "stroke": { "$ref": "#/definitions/strokeSymbolNode" },
        "radius": {
          "type": "number"
        }
      }
    },
    "circleSymbolVectorSettings": {
      "type": "object",
      "properties": {
        "fill": { "$ref": "#/definitions/fillSymbolNode" },
        "stroke": { "$ref": "#/definitions/strokeSymbolNode" },
        "radius": {
          "type": "number"
        }
      },
      "required": ["radius"]
    },
    "iconSymbolVectorSettings": {
      "type": "object",
      "properties": {
        "src": {
          "type": "string"
        },
        "size": {
          "type": "integer",
          "description": "Icon size in pixel."
        },
        "opacity": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 1
        },
        "crossOrigin": {
          "type": "string",
          "description": "The crossOrigin attribute for loaded images. Note that you must provide a crossOrigin value if you want to access pixel data with the Canvas renderer."
        }
      }
    },
    "simpleStyleNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "styleType": {
          "type": "string",
          "enum": ["simple"]
        },
        "label": {
          "type": "string"
        },
        "options": {
          "oneOf": [
            { "$ref": "#/definitions/simpleSymbolVectorSettings" },
            { "$ref": "#/definitions/circleSymbolVectorSettings" },
            { "$ref": "#/definitions/iconSymbolVectorSettings" }
          ]
        }
      },
      "required": ["styleType", "label", "options"]
    },
    "uniqueValueStyleNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "styleType": {
          "type": "string",
          "enum": ["uniqueValue"]
        },
        "label": {
          "type": "string"
        },
        "fields": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1
        },
        "uniqueValueStyleInfo": {
          "type": "array",
          "items": {
            "label": {
              "type": "string"
            },
            "values": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "minItems": 1
            },
            "options": {
              "oneOf": [
                { "$ref": "#/definitions/simpleSymbolVectorSettings" },
                { "$ref": "#/definitions/circleSymbolVectorSettings" },
                { "$ref": "#/definitions/iconSymbolVectorSettings" }
              ]
            }
          },
          "minItems": 2,
          "required": ["label", "values", "options"]
        }
      },
      "required": ["styleType", "label", "fields", "uniqueValueStyleInfo"]
    },
    "classBreakStyleNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "styleType": {
          "type": "string",
          "enum": ["classBreak"]
        },
        "label": {
          "type": "string"
        },
        "field": {
          "type": "string"
        },
        "classBreakStyleInfo": {
          "type": "array",
          "items": {
            "label": {
              "type": "string"
            },
            "minValues": {
              "type": "number"
            },
            "maxValues": {
              "type": "number"
            },
            "options": {
              "oneOf": [
                { "$ref": "#/definitions/simpleSymbolVectorSettings" },
                { "$ref": "#/definitions/circleSymbolVectorSettings" },
                { "$ref": "#/definitions/iconSymbolVectorSettings" }
              ]
            }
          },
          "minItems": 2,
          "required": ["label", "minValue", "maxValue", "options"]
        }
      },
      "required": ["styleType", "label", "field", "classBreakStyleInfo"]
    },
    "styleNode": {
      "oneOf": [
        { "$ref": "#/definitions/simpleStyleNode" },
        { "$ref": "#/definitions/uniqueValueStyleNode" },
        { "$ref": "#/definitions/classBreakStyleNode" }
      ]
    },
    "layerMetadataUrlNode": {
      "type": "object",
      "properties": {
        "en": {
          "type": "string",
          "default": null,
          "description": "The metadata url of the layer service (English)."
        },
        "fr": {
          "type": "string",
          "default": null,
          "description": "The metadata url of the layer service (French)."
        }
      }
    },
    "layerNameNode": {
      "type": "object",
      "properties": {
        "en": {
          "type": "string",
          "description": "The display name of the layer (English). If it is not present the viewer will make an attempt to scrape this information."
        },
        "fr": {
          "type": "string",
          "description": "The display name of the layer (French). If it is not present the viewer will make an attempt to scrape this information."
        }
      }
    },
    "layerBasicInfoNode": {
      "type": "object",
      "properties": {
        "layerIdNode": {
          "type": "string",
          "description": "The id of the layer for referencing within the viewer (does not relate directly to any external service). The id will have the language extension (id-'lang')."
        },
        "layerNameNode": {
          "type": "object",
          "properties": {
            "en": {
              "type": "string",
              "description": "The display name of the layer (English). If it is not present the viewer will make an attempt to scrape this information."
            },
            "fr": {
              "type": "string",
              "description": "The display name of the layer (French). If it is not present the viewer will make an attempt to scrape this information."
            }
          }
        },
        "layerMetadataUrlNode": {
          "type": "object",
          "properties": {
            "en": {
              "type": "string",
              "default": null,
              "description": "The metadata url of the layer service (English)."
            },
            "fr": {
              "type": "string",
              "default": null,
              "description": "The metadata url of the layer service (French)."
            }
          }
        }
      }
    },
    "layerInitialSettingsNode": {
      "type": "object",
      "properties": {
        "layerOpacityNode": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 1,
          "description": "Initial opacity setting."
        },
        "layerVisibilityNode": {
          "type": "boolean",
          "default": true,
          "description": "Initial visibility setting."
        },
        "layerExtentNode": {
          "type": "array",
          "minItems": 4,
          "maxItems": 4,
          "items": {
            "type": "number"
          },
          "description": "The extent that constrains the view. Called with [minX, minY, maxX, maxY] extent coordinates."
        },
        "layerMinZoomNode": {
          "type": "integer",
          "description": "The minimum view zoom level (exclusive) above which this layer will be visible."
        },
        "layerMaxZoomNode": {
          "type": "integer",
          "description": "The maximum view zoom level (inclusive) above which this layer will be visible."
        },
        "layerClassNameNode": {
          "type": "string",
          "description": "A CSS class name to set to the layer element."
        }
      }
    },

    "sourceUrlNode": {
      "type": "object",
      "properties": {
        "en": {
          "type": "string",
          "description": "The service endpoint of the layer (English). It should match the type provided in layerType."
        },
        "fr": {
          "type": "string",
          "description": "The service endpoint of the layer (French). It should match the type provided in layerType."
        }
      }
    },
    "sourceInitialSettingsNode": {
      "type": "object",
      "properties": {
        "layerOpacityNode": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 1,
          "description": "Initial opacity setting."
        },
        "layerVisibilityNode": {
          "type": "boolean",
          "default": true,
          "description": "Initial visibility setting."
        },
        "query": {
          "type": "boolean",
          "default": true,
          "description": "Allow querying."
        }
      }
    },

    "vectorSourceInitialSettings": {
      "type": "object",
      "properties": {
        "format": {
          "type": "string",
          "enum": ["GeoJSON", "EsriJSON", "KML", "WFS", "featureAPI"],
          "description": "The feature format used by the XHR feature loader when url is set."
        },
        "featureInfo": { "$ref": "#/definitions/featureInfoLayerSettings" },
        "cluster": {
          "type": "object",
          "description": "Cluster vector data on vector layer. Works out of the box with point geometries. If another geometry is provided, it will be converted to points geometry.",
          "properties": {
            "enable": {
              "type": "boolean",
              "default": false
            },
            "distance": {
              "type": "integer",
              "description": "Distance in pixels within which features will be clustered together (deafult 20px)."
            },
            "minDistance": {
              "type": "integer",
              "description": "Minimum distance in pixels between clusters. Will be capped at the configured distance. By default no minimum distance is guaranteed. This config can be used to avoid overlapping icons. As a tradoff, the cluster feature's position will no longer be the center of all its features."
            }
          }
        }
      },
      "required": ["format"]
    },
    "esriImageSourceLayerNode": {
      "type": "object",
      "properties": {
        "index": {
          "type": "number",
          "description": "The index of the layer in the map service."
        },
        "info": { "$ref": "#/definitions/layerBasicInfoNode" },
        "state": {
          "$ref": "#/definitions/sourceInitialSettingsNode"
        },
        "featureInfo": { "$ref": "#/definitions/featureInfoLayerSettings" }
      },
      "required": ["index"],
      "additionalProperties": false
    },
    "wmsImageSourceLayerNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer entry in the WMS."
        },
        "info": { "$ref": "#/definitions/layerBasicInfoNode" },
        "state": {
          "$ref": "#/definitions/sourceInitialSettingsNode"
        },
        "featureInfo": { "$ref": "#/definitions/featureInfoLayerSettings" }
      },
      "required": ["id"],
      "additionalProperties": false
    },
    "sourceImageInitialSettings": {
      "type": "object",
      "properties": {
        "url": { "$ref": "#/definitions/sourceUrlNode" },
        "sourceType": {
          "type": "string",
          "enum": ["WMS, ESRI"],
          "default": "WMS"
        },
        "paramsWMS": {
          "type": "object",
          "properties": {
            "layers": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/wmsImageSourceLayerNode"
              },
              "minItems": 1,
              "description": "Array of LAYERS to use for this WMS source."
            },
            "style": {
              "type": "string",
              "default": "",
              "description": "Style to apply"
            }
          }
        },
        "paramsESRI": {
          "type": "object",
          "properties": {
            "layers": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/esriImageSourceLayerNode"
              },
              "minItems": 1,
              "description": "Array of LAYERS to use for this ESRI source."
            },
            "format": {
              "type": "string",
              "enum": ["png", "jpg", "gif", "svg"],
              "default": "png",
              "description": "The format of the exported image. The default format is png."
            },
            "transparent": {
              "type": "boolean",
              "default": true,
              "description": "If true, the image will be exported with the background color of the map set as its transparent color. Only the .png and .gif formats support transparency."
            }
          },
          "description": "ArcGIS Rest parameters. This field is optional. Service defaults will be used for any fields not specified. https://developers.arcgis.com/rest/services-reference/enterprise/export-map.htm"
        },
        "crossOrigin": {
          "type": "string",
          "description": "The crossOrigin attribute for loaded images. Note that you must provide a crossOrigin value if you want to access pixel data with the Canvas renderer."
        },
        "serverType": {
          "type": "string",
          "enum": ["mapserver, geoserver, qgis"],
          "description": "The type of the remote WMS server. Not needed for type ESRI"
        },
        "projection": {
          "type": "integer",
          "description": "Spatial Reference EPSG code supported (https://epsg.io/). We support Web Mercator and Lambert Conical Conform Canada."
        }
      },
      "oneOf": [{ "required": ["url", "sourceType", "paramsWMS"] }, { "required": ["url", "sourceType", "paramsESRI"] }]
    },
    "sourceTileInitialSettings": {
      "sourceType": "object",
      "properties": {
        "url": { "$ref": "#/definitions/sourceUrlNode" },
        "sourceType": {
          "type": "string",
          "enum": ["XYZ, GeoTIFF"],
          "default": "XYZ"
        },
        "projection": {
          "type": "integer",
          "description": "Spatial Reference EPSG code supported (https://epsg.io/). We support Web Mercator and Lambert Conical Conform Canada."
        },
        "tileGrid": {
          "type": "object",
          "properties": {
            "extent": {
              "type": "array",
              "prefixItems": [
                {
                  "type": "number"
                },
                {
                  "type": "number"
                },
                {
                  "type": "number"
                },
                {
                  "type": "number"
                }
              ],
              "description": "The extent that constrains the view. Called with [minX, minY, maxX, maxY] extent coordinates."
            },
            "origin": {
              "type": "array",
              "prefixItems": [
                {
                  "type": "number"
                },
                {
                  "type": "number"
                }
              ],
              "description": "The tile grid origin, i.e. where the x and y axes meet ([z, 0, 0]). Tile coordinates increase left to right and downwards. If not specified, extent must be provided."
            },
            "resolutions": {
              "type": "array",
              "items": {
                "type": "number"
              },
              "description": "Resolutions. The array index of each resolution needs to match the zoom level. This means that even if a minZoom is configured, the resolutions array will have a length of maxZoom + 1."
            },
            "tileSize": {
              "type": "array",
              "prefixItems": [
                {
                  "type": "number"
                },
                {
                  "type": "number"
                }
              ],
              "default": [256, 256],
              "description": "The tile grid origin, i.e. where the x and y axes meet ([z, 0, 0]). Tile coordinates increase left to right and downwards. If not specified, extent must be provided."
            }
          },
          "required": ["origin", "resolutions"]
        }
      },
      "required": ["url", "sourceType"]
    },

    "vectorHeatmapLayerNode": {
      "type": "object",
      "properties": {
        "info": { "$ref": "#/definitions/layerBasicInfoNode" },
        "initialSettings": { "$ref": "#/definitions/layerInitialSettingsNode" },
        "layerType": {
          "type": "string",
          "enum": ["vectorHeatmap"],
          "description": "Layer for rendering vector data as a heatmap. Use points as source. If another geometry is provided, it will be converted to points geometry."
        },
        "source": { "$ref": "#/definitions/vectorSourceInitialSettings" },
        "gradient": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "uniqueItems": true,
          "minItems": 2,
          "default": ["#00f", "#0ff", "#0f0", "#ff0", "#f00"],
          "description": "Color gradient of the heatmap, specified as an array of CSS color strings."
        },
        "radius": {
          "type": "number",
          "description": "Radius size in pixels (default 8px)."
        },
        "blur": {
          "type": "number",
          "description": "Blur size in pixels (default 15px)."
        },
        "weight": {
          "type": "string",
          "description": "Feature attribute to use for the weight or a function (ADD FORMAT) that returns a weight from a feature."
        }
      },
      "required": ["layerType", "source"]
    },
    "vectorLayerNode": {
      "type": "object",
      "properties": {
        "info": { "$ref": "#/definitions/layerBasicInfoNode" },
        "initialSettings": { "$ref": "#/definitions/layerInitialSettingsNode" },
        "layerType": {
          "type": "string",
          "enum": ["vector"],
          "description": "Vector data is rendered client-side, as vectors. This layer type provides most accurate rendering even during animations. Points and labels stay upright on rotated views. For very large amounts of vector data, performance may suffer during pan and zoom animations."
        },
        "sourceType": { "$ref": "#/definitions/vectorSourceInitialSettings" },
        "style": { "$ref": "#/definitions/styleNode" }
      },
      "required": ["layerType", "sourceType"]
    },
    "vectorTileLayerNode": {
      "type": "object",
      "description": "Layer sources providing vector data divided into a tile grid.",
      "properties": {
        "info": { "$ref": "#/definitions/layerBasicInfoNode" },
        "initialSettings": { "$ref": "#/definitions/layerInitialSettingsNode" },
        "layerType": {
          "type": "string",
          "enum": ["vectorTile"],
          "description": "Layer for vector tile data that is rendered client-side."
        },
        "source": {
          "type": "object",
          "description": "Layer sources providing vector data divided into a tile grid.",
          "properties": {
            "url": { "$ref": "#/definitions/sourceUrlNode" },
            "sourceType": {
              "type": "string",
              "enum": ["vectorTile"],
              "default": "vectorTile"
            },
            "format": {
              "type": "string",
              "enum": ["GeoJSON", "EsriJSON", "KML", "WFS", "MVT", "featureAPI"],
              "description": "The feature format used by the XHR feature loader when url is set."
            },
            "featureInfo": { "$ref": "#/definitions/featureInfoLayerSettings" },
            "style": { "$ref": "#/definitions/styleNode" },
            "projection": {
              "type": "integer",
              "description": "Spatial Reference EPSG code supported (https://epsg.io/). We support Web Mercator and Lambert Conical Conform Canada."
            },
            "tileGrid": {
              "type": "object",
              "properties": {
                "extent": {
                  "type": "array",
                  "prefixItems": [
                    {
                      "type": "number"
                    },
                    {
                      "type": "number"
                    },
                    {
                      "type": "number"
                    },
                    {
                      "type": "number"
                    }
                  ],
                  "description": "The extent that constrains the view. Called with [minX, minY, maxX, maxY] extent coordinates."
                },
                "origin": {
                  "type": "array",
                  "prefixItems": [
                    {
                      "type": "number"
                    },
                    {
                      "type": "number"
                    }
                  ],
                  "description": "The tile grid origin, i.e. where the x and y axes meet ([z, 0, 0]). Tile coordinates increase left to right and downwards. If not specified, extent must be provided."
                },
                "resolutions": {
                  "type": "array",
                  "items": {
                    "type": "number"
                  },
                  "description": "Resolutions. The array index of each resolution needs to match the zoom level. This means that even if a minZoom is configured, the resolutions array will have a length of maxZoom + 1."
                },
                "tileSize": {
                  "type": "array",
                  "prefixItems": [
                    {
                      "type": "number"
                    },
                    {
                      "type": "number"
                    }
                  ],
                  "default": [256, 256],
                  "description": "The tile grid origin, i.e. where the x and y axes meet ([z, 0, 0]). Tile coordinates increase left to right and downwards. If not specified, extent must be provided."
                }
              },
              "required": ["origin", "resolutions"]
            }
          },
          "required": ["url", "sourceType"]
        }
      },
      "required": ["layerType", "source"]
    },
    "imageLayerNode": {
      "type": "object",
      "properties": {
        "info": { "$ref": "#/definitions/layerBasicInfoNode" },
        "initialSettings": { "$ref": "#/definitions/layerInitialSettingsNode" },
        "layerType": {
          "type": "string",
          "enum": ["image"],
          "description": "Server-rendered images that are available for arbitrary extents and resolutions like OGC WMS, ESRI MapServer, ESRI ImageServer, ..."
        },
        "source": { "$ref": "#/definitions/sourceImageInitialSettings" }
      },
      "required": ["layerType", "source"]
    },
    "tileLayerNode": {
      "type": "object",
      "properties": {
        "info": { "$ref": "#/definitions/layerBasicInfoNode" },
        "initialSettings": { "$ref": "#/definitions/layerInitialSettingsNode" },
        "layerType": {
          "type": "string",
          "enum": ["tile"],
          "description": "Layer sources that provide pre-rendered, tiled images in grids that are organized by zoom levels for specific resolutions like OGC WMTS, GeoTIFF, XYZ, ESRI TileServer, ..."
        },
        "source": { "$ref": "#/definitions/sourceTileInitialSettings" }
      },
      "required": ["layerType", "source"]
    },
    "geoCoreLayerNode": {
      "type": "object",
      "description": "Layer where configration is extracted by a configuration snippet stored on a server",
      "properties": {
        "id": {
          "type": "string",
          "description": "The GeoCore catalog uuid of the layer. The id will have the language extension (id-'lang')."
        },
        "url": {
          "type": "string",
          "description": "The url path to the geoCore endpoint (optional, this value should be embeded in the GeoView API)."
        },
        "layerType": {
          "type": "string",
          "enum": ["geoCore"]
        }
      },
      "required": ["id", "layerType"],
      "additionalProperties": false
    },
    "basicLayer": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer for referencing within the viewer (does not relate directly to any external service). The id will have the language extension (id-'lang')."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "url": {
          "$ref": "#/definitions/sourceUrlNode"
        },
        "layerType": {
          "type": "string",
          "enum": ["ogcWms", "ogcWfs", "geoJson", "csv", "esriDynamic", "esriFeature", "esriImage", "esriTile"]
        }
      },
      "required": ["id", "layerType", "url"]
    },
    "basicLayerNode": {
      "type": "object",
      "description": "Layer for rendering vector data as a heatmap",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer for referencing within the viewer (does not relate directly to any external service). The id will have the language extension (id-'lang')."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "url": {
          "$ref": "#/definitions/sourceUrlNode"
        },
        "layerType": {
          "type": "string",
          "enum": ["esriImage", "esriTile"]
        },
        "metadataUrl": {
          "$ref": "#/definitions/layerMetadataUrlNode"
        },
        "state": {
          "$ref": "#/definitions/layerInitialSettingsNode"
        },
        "details": {
          "$ref": "#/definitions/detailsLayerSettings"
        }
      },
      "required": ["id", "layerType", "url"],
      "additionalProperties": false
    },
    "featureLayerNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer for referencing within the viewer (does not relate directly to any external service). The id will have the language extension (id-'lang')."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "url": {
          "$ref": "#/definitions/sourceUrlNode"
        },
        "layerType": {
          "type": "string",
          "enum": ["esriFeature"]
        },
        "metadataUrl": {
          "$ref": "#/definitions/layerMetadataUrlNode"
        },
        "nameField": {
          "type": "string",
          "description": "The display field of the layer. If it is not present the viewer will make an attempt to scrape this information."
        },
        "tooltipField": {
          "type": "string",
          "description": "The field to be used for tooltips. If it is not present the viewer will use nameField (if provided)."
        },
        "outfields": {
          "type": "string",
          "default": "*",
          "description": "A comma separated list of attribute names that should be requested on query."
        },
        "state": {
          "$ref": "#/definitions/layerInitialSettingsNode"
        },
        "details": {
          "$ref": "#/definitions/detailsLayerSettings"
        }
      },
      "required": ["id", "layerType", "url"],
      "additionalProperties": false
    },
    "dynamicLayerNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer for referencing within the viewer (does not relate directly to any external service). The id will have the language extension (id-'lang')."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "url": {
          "$ref": "#/definitions/sourceUrlNode"
        },
        "layerType": {
          "type": "string",
          "enum": ["esriDynamic"]
        },
        "metadataUrl": {
          "$ref": "#/definitions/layerMetadataUrlNode"
        },
        "layerEntries": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/dynamicLayerEntryNode"
          },
          "minItems": 1
        },
        "state": {
          "$ref": "#/definitions/layerInitialSettingsNode"
        },
        "details": {
          "$ref": "#/definitions/detailsLayerSettings"
        }
      },
      "required": ["id", "layerType", "layerEntries", "url"],
      "additionalProperties": false
    },
    "dynamicLayerEntryNode": {
      "type": "object",
      "properties": {
        "index": {
          "type": "number",
          "description": "The index of the layer in the map service."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "nameField": {
          "type": "string",
          "description": "The display field of the layer.  If it is not present the viewer will make an attempt to scrape this information."
        },
        "outfields": {
          "type": "string",
          "default": "*",
          "description": "A comma separated list of attribute names that should be requested on query."
        },
        "state": {
          "$ref": "#/definitions/layerInitialSettingsNode"
        }
      },
      "required": ["index"],
      "additionalProperties": false
    },
    "geoJsonLayerNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer for referencing within the viewer (does not relate directly to any external service). The id will have the language extension (id-'lang')."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "url": {
          "$ref": "#/definitions/sourceUrlNode"
        },
        "layerType": {
          "type": "string",
          "enum": ["geojson"]
        },
        "nameField": {
          "type": "string",
          "description": "The display field of the layer. If it is not present the viewer will make an attempt to find the first valid field."
        },
        "tooltipField": {
          "type": "string",
          "description": "The field to be used for tooltips.  If it is not present the viewer will use nameField (if provided)."
        },
        "renderer": {
          "type": "object",
          "additionalProperties": true,
          "description": "Optional renderer object to apply to the layer. Follows Leaflet Path json convention."
        },
        "state": {
          "$ref": "#/definitions/layerInitialSettingsNode"
        },
        "details": {
          "$ref": "#/definitions/detailsLayerSettings"
        }
      },
      "required": ["id", "name", "layerType", "url"],
      "additionalProperties": false
    },
    "wfsLayerNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer for referencing within the viewer (does not relate directly to any external service). The id will have the language extension (id-'lang')."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "url": {
          "$ref": "#/definitions/sourceUrlNode"
        },
        "layerEntries": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/wfsLayerEntryNode"
          },
          "minItems": 1
        },
        "layerType": {
          "type": "string",
          "enum": ["ogcWfs"]
        },
        "nameField": {
          "type": "string",
          "description": "The display field of the layer. If it is not present the viewer will make an attempt to scrape this information."
        },
        "tooltipField": {
          "type": "string",
          "description": "The field to be used for tooltips.  If it is not present the viewer will use nameField (if provided)."
        },
        "renderer": {
          "type": "object",
          "additionalProperties": true,
          "description": "Optional renderer object to apply to the layer. Follows Leaflet Path json convention."
        },
        "state": {
          "$ref": "#/definitions/layerInitialSettingsNode"
        },
        "details": {
          "$ref": "#/definitions/detailsLayerSettings"
        }
      },
      "required": ["id", "layerType", "layerEntries", "url"],
      "additionalProperties": false
    },
    "wfsLayerEntryNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer entry in the WFS."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "state": {
          "$ref": "#/definitions/layerInitialSettingsNode"
        }
      },
      "required": ["id"],
      "additionalProperties": false
    },
    "wmsLayerNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer for referencing within the viewer (does not relate directly to any external service). The id will have the language extension (id-'lang')."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "url": {
          "$ref": "#/definitions/sourceUrlNode"
        },
        "layerEntries": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/wmsLayerEntryNode"
          },
          "minItems": 1
        },
        "layerType": {
          "type": "string",
          "enum": ["ogcWms"]
        },
        "metadataUrl": {
          "$ref": "#/definitions/layerMetadataUrlNode"
        },
        "state": {
          "$ref": "#/definitions/layerInitialSettingsNode"
        },
        "details": {
          "$ref": "#/definitions/detailsLayerSettings"
        }
      },
      "required": ["id", "layerType", "layerEntries", "url"],
      "additionalProperties": false
    },
    "wmsLayerEntryNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer entry in the WMS."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "state": {
          "$ref": "#/definitions/layerInitialSettingsNode"
        }
      },
      "required": ["id"],
      "additionalProperties": false
    },
    "geometryEndpointLayerNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer for referencing within the viewer (does not relate directly to any external service). The id will have the language extension (id-'lang')."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "url": {
          "$ref": "#/definitions/sourceUrlNode"
        },
        "layerType": {
          "type": "string",
          "enum": ["geojsonEndpoint"]
        },
        "nameField": {
          "type": "string",
          "description": "The display field of the layer. If it is not present the viewer will make an attempt to find the first valid field."
        },
        "tooltipField": {
          "type": "string",
          "description": "The field to be used for tooltips.  If it is not present the viewer will use nameField (if provided)."
        },
        "renderer": {
          "type": "object",
          "additionalProperties": true,
          "description": "Optional renderer object to apply to the layer. Follows Leaflet Path json convention."
        },
        "state": {
          "$ref": "#/definitions/layerInitialSettingsNode"
        },
        "details": {
          "$ref": "#/definitions/detailsLayerSettings"
        }
      },
      "required": ["id", "name", "layerType", "url"],
      "additionalProperties": false
    },
    "xyzTilesLayerNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer for referencing within the viewer (does not relate directly to any external service). The id will have the language extension (id-'lang')."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "url": {
          "$ref": "#/definitions/sourceUrlNode"
        },
        "layerType": {
          "type": "string",
          "enum": ["xyzTiles"]
        },
        "metadataUrl": {
          "$ref": "#/definitions/layerMetadataUrlNode"
        },
        "nameField": {
          "type": "string",
          "description": "The display field of the layer. If it is not present the viewer will make an attempt to scrape this information."
        },
        "tooltipField": {
          "type": "string",
          "description": "The field to be used for tooltips. If it is not present the viewer will use nameField (if provided)."
        },
        "outfields": {
          "type": "string",
          "default": "*",
          "description": "A comma separated list of attribute names that should be requested on query."
        },
        "state": {
          "$ref": "#/definitions/layerInitialSettingsNode"
        },
        "details": {
          "$ref": "#/definitions/detailsLayerSettings"
        }
      },
      "required": ["id", "layerType", "url"],
      "additionalProperties": false
    },
    "ogcFeatureLayerNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer for referencing within the viewer (does not relate directly to any external service). The id will have the language extension (id-'lang')."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "url": {
          "$ref": "#/definitions/sourceUrlNode"
        },
        "layerEntries": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ogcFeatureLayerEntryNode"
          },
          "minItems": 1
        },
        "layerType": {
          "type": "string",
          "enum": ["ogcFeature"]
        },
        "metadataUrl": {
          "$ref": "#/definitions/layerMetadataUrlNode"
        },
        "state": {
          "$ref": "#/definitions/layerInitialSettingsNode"
        },
        "details": {
          "$ref": "#/definitions/detailsLayerSettings"
        }
      },
      "required": ["id", "layerType", "layerEntries", "url"],
      "additionalProperties": false
    },
    "ogcFeatureLayerEntryNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The id of the layer entry in the WMS."
        },
        "name": {
          "$ref": "#/definitions/layerNameNode"
        },
        "state": {
          "$ref": "#/definitions/layerInitialSettingsNode"
        }
      },
      "required": ["id"],
      "additionalProperties": false
    },
    "layerNode": {
      "type": "object",
      "oneOf": [
        { "$ref": "#/definitions/vectorHeatmapLayerNode" },
        { "$ref": "#/definitions/vectorTileLayerNode" },
        { "$ref": "#/definitions/vectorLayerNode" },
        { "$ref": "#/definitions/imageLayerNode" },
        { "$ref": "#/definitions/tileLayerNode" },
        { "$ref": "#/definitions/geoCoreLayerNode" }
      ]
    },
    "layerList": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/layerNode"
      },
      "minItems": 0
    }
  },

  "properties": {
    "map": {
      "type": "object",
      "properties": {
        "basemapOptions": {
          "type": "object",
          "properties": {
            "id": {
              "type": "string",
              "enum": ["transport", "simple", "osm", "nogeom"],
              "default": "transport",
              "description": "Id of the basemap to use."
            },
            "shaded": {
              "type": "boolean",
              "default": true,
              "description": "Enable or disable shaded basemap (if basemap id is set to shaded then this should be false)."
            },
            "labeled": {
              "type": "boolean",
              "default": true,
              "description": "Enable or disable basemap labels"
            }
          },
          "required": ["id", "shaded", "labeled"]
        },
        "interaction": {
          "type": "string",
          "enum": ["static", "dynamic"],
          "default": "dynamic",
          "description": "If map is dynamic (pan/zoom) or static to act as a thumbnail (no nav bar)."
        },
        "layers": {
          "$ref": "#/definitions/layerList",
          "description": "Layers list in the order which they should be added to the map."
        },
        "view": {
          "type": "object",
          "properties": {
            "center": {
              "type": "array",
              "prefixItems": [
                {
                  "type": "integer",
                  "minimum": -80,
                  "maximum": 80,
                  "default": 60,
                  "description": "Initial latitude value for map center."
                },
                {
                  "type": "integer",
                  "minimum": -160,
                  "maximum": 160,
                  "default": -106,
                  "description": "Initial longitude value for map center."
                }
              ]
            },
            "enableRotation": {
              "type": "boolean",
              "default": true,
              "description": "Enable rotation. If false, a rotation constraint that always sets the rotation to zero is used."
            },
            "extent": {
              "type": "array",
              "prefixItems": [
                {
                  "type": "number"
                },
                {
                  "type": "number"
                },
                {
                  "type": "number"
                },
                {
                  "type": "number"
                }
              ],
              "description": "The extent that constrains the view. Called with [minX, minY, maxX, maxY] extent coordinates."
            },
            "minZoom": {
              "type": "integer",
              "description": "The minimum zoom level used to determine the resolution constraint. If not set, will use default from basemap."
            },
            "maxZoom": {
              "minZoom": {
                "type": "integer",
                "description": "The minimum zoom level used to determine the resolution constraint. If not set, will use default from basemap."
              }
            },
            "projection": {
              "type": "integer",
              "enum": [3978, 3857],
              "default": 3978,
              "description": "Spatial Reference EPSG code supported (https://epsg.io/). We support Web Mercator and Lambert Conical Conform Canada."
            },
            "rotation": {
              "type": "integer",
              "minimum": 0,
              "maximum": 360,
              "default": 0,
              "description": "The initial rotation for the view in degree (positive rotation clockwise, 0 means North). Will be converted to radiant by the viewer."
            },
            "zoom": {
              "type": "integer",
              "minimum": 0,
              "maximum": 28,
              "default": 12,
              "description": "Initial map zoom level. Zoom level are define by the basemap zoom levels."
            }
          },
          "required": ["zoom", "center", "projection"]
        },
        "extraOptions": {
          "type": "object",
          "description": "Additional options used for OpenLayers map options"
        }
      },
      "required": ["basemapOptions", "interaction", "view"]
    },
    "theme": {
      "type": "string",
      "enum": ["dark", "light"],
      "default": "dark",
      "description": "Theme style the viewer."
    },
    "appBar": {
      "type": "object",
      "properties": {
        "about": {
          "type": "object",
          "properties": {
            "en": {
              "type": "string"
            },
            "fr": {
              "type": "string"
            }
          },
          "required": ["en", "fr"],
          "description": "The content of the about section in Markdown format. If empty, it will be ignored. If not, it will create a button on the appbar to open the panel."
        }
      }
    },
    "navBar": {
      "type": "array",
      "uniqueItems": true,
      "items": {
        "type": "string",
        "enum": ["zoom", "fullscreen", "fullextent"]
      },
      "default": ["zoom", "fullscreen", "fullextent"],
      "description": "Controls availalbe on the navigation bar.",
      "minItems": 0
    },
    "components": {
      "type": "array",
      "uniqueItems": true,
      "items": {
        "type": "string",
        "enum": ["appbar", "navbar", "overview-map", "north-arrow"]
      },
      "default": ["appbar", "navbar", "overview-map", "north-arrow"],
      "description": "Core components to initialize on viewer load. The schema for those are inside this file.",
      "minItems": 0
    },
    "corePackages": {
      "type": "array",
      "uniqueItems": true,
      "items": {
        "type": "string",
        "enum": ["basemap-panel", "layers-panel", "details-panel", "geolocator-panel"]
      },
      "default": ["basemap-panel", "layers-panel", "details-panel", "geolocator-panel"],
      "description": "Core packages to initialize on viewer load. The schema for those are on their own package. NOTE: config from packages are in the same loaction as core config (<<core config name>>-<<package name>>.json).",
      "minItems": 0
    },
    "externalPackages": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "External Package name. The name must be ideintical to the window external package object to load."
          },
          "configUrl": {
            "type": "string",
            "description": "The url to the external package configuration setting. The core package will read the configuration and pass it inside the package."
          }
        },
        "required": ["name"]
      },
      "default": [],
      "description": "List of external packages to initialize on viewer load.",
      "minItems": 0
    },
    "serviceUrls": {
      "type": "object",
      "description": "Service endpoint urls",
      "properties": {
        "keys": {
          "type": "string",
          "default": "https://geocore.api.geo.ca",
          "description": "Service end point to access API for layers specification (loading and plugins parameters). By default it is GeoCore but can be another endpoint with similar output."
        },
        "proxyUrl": {
          "type": "string",
          "description": "An optional proxy to be used for dealing with same-origin issues.  URL must either be a relative path on the same server or an absolute path on a server which sets CORS headers."
        }
      }
    },
    "languages": {
      "type": "array",
      "uniqueItems": true,
      "items": {
        "type": "string",
        "enum": ["en-CA", "fr-CA"]
      },
      "default": ["en-CA", "fr-CA"],
      "description": "ISO 639-1 code indicating the languages supported by the configuration file.",
      "minItems": 1
    },
    "version": {
      "type": "string",
      "enum": ["1.0"],
      "description": "The schema version used to validate the configuration file. The schema should enumerate the list of versions accepted by this version of the viewer."
    }
  },
  "required": ["map", "languages"]
}
